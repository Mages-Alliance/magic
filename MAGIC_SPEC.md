# Magic: A System Specification

**Version:** 1.0
**Status:** Active

## 1. Core Philosophy: The Wizard and the Spirit

Magic is not a monolithic application but a framework for the modern **Wizard** (the user) to enact their will. The Wizard summons a supportive **Spirit** (the AI agent) and gives it power by casting **Spells** (prompts).

The Wizard's power comes from their knowledge of the spells and how to chain them together. The Spirit's role is to be a faithful medium, receiving the spells and presenting the results of the magic.

The standard ritual follows three phases:
1.  **The Summoning (Bootstrap):** The Wizard follows a **Summoning Ritual** from the Spellbook. This involves casting a sequence of modular spells to build the Spirit's foundational awareness (the "base system").
2.  **Working Magic (Operation):** The Wizard casts further spells or teaches the Spirit from a **Scroll**, building upon the summoned base system to perform specific tasks.
3.  **Chronicling (Consolidation):** The Wizard casts a final spell to have the Spirit record a summary of the session.

## 2. Architecture: The Wizard's Scrolls

The Magic framework is application-agnostic. Its true power lies in the **Scrolls** (extensions) that the Wizard studies. Each Scroll adds new spells to the Wizard's Spellbook, granting the Spirit new capabilities.

### Extension Design Principles

All extensions (Scrolls) MUST adhere to the following architectural rules:

*   **Data Separation:** Extensions are stateless. The Spirit operates on data stored in the root `data/` directory, which belongs to the Wizard.
*   **Self-Containment:** An extension must clearly document the data format it requires in its own `README.md`. All artifacts it generates must be saved to a sub-directory within the extension's own folder.
*   **Single Layer:** Extensions should extend the core system, but not other extensions.
*   **Git-Managed:** Each extension should be a self-contained unit, ideally managed as its own Git repository.

## 3. Core Components

*   **IDE User Rules:** The out-of-project definition of the Spirit's core identity. Instructions for setting these are in `system/02-user_rules.md`.
*   **`system/` directory:** Contains the foundational components of the Magic framework.
    *   `00-spellbook.md`: The central **Spellbook**, containing all summoning rituals.
    *   `01-principles.md`: A detailed explanation of the core philosophical principles.
    *   `02-user_rules.md`: Instructions for the one-time setup of the Spirit's identity.
    *   `spells/`: A directory of modular, self-contained **Foundational Spells** that form the base system.
*   **`scrolls/` directory:** The home for all Scrolls (application-level prompt bundles).
*   **`data/` directory:** The designated location for all the Wizard's data.
*   **`MAGIC_SPEC.md` (This document):** The canonical source of truth for the system's design.
*   **`README.md`:** The Wizard's "Getting Started" guide.

## 4. The Principle of Resonance

The core operational principle of Magic is **Resonance**. A spell is not a single, monolithic command but a part of a sequence. Each spell cast in a sequence serves to tune the Spirit, bringing it into closer alignment with the Wizard's ultimate goal. This build-up of alignment is called Resonance.

Successful magic is not about the power of a single spell, but about the accumulated Resonance of a well-crafted sequence. It is a measure of "context readiness." When Resonance is high, the Spirit is perfectly attuned to the task, and its final operation will be efficient and precise. When Resonance is low, the spell may fail or produce unintended consequences. The bootstrap sequences in the Spellbook are designed explicitly to build this Resonance.

## 5. Agent Behavior: A System of Layered Rules

The Spirit's behavior is composed of layered rule sets. Its base behavior is governed by the Wizard's global preferences (the "user rules"). The Scrolls it is given provide temporary, topic-relevant rule sets on top of that base. The Spirit will always announce which rules it is operating under at the start of a session.

## 6. Architectural Traceability

This section maps the core design principles to their direct implementation in the project's structure.

| Principle | Implementation |
|---|---|
| **The Wizard and the Spirit** | The Spirit's core identity is defined in the IDE's User Rules (see `system/02-user_rules.md`). The summoning rituals in the `system/00-spellbook.md` build upon this identity. |
| **The Principle of Resonance** | The multi-step **Foundational Summoning Ritual** in `system/00-spellbook.md`, which uses the modular spells in `system/spells/` to progressively build the Spirit's context. |
| **Session Consolidation** | The `system/memory/` directory, which is the target for the session summary generated by the "goodbye" spell. |
| **Extension Architecture (Scrolls)** | The `scrolls/` directory, which houses all modular application logic. |
| **Data Separation** | The root `data/` directory, which is explicitly separated from the `scrolls/` and `system/` logic. |
| **Self-Containment** | The `scrolls/qualified_self/reports/` directory and the `scrolls/qualified_self/README.md` file are examples. |
| **Layered Rule System** | The Spirit's base identity is set in User Rules. The **Foundational Summoning Ritual** builds the base system layer. Scrolls then add an application-specific layer on top. |
